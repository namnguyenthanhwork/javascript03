const tableCustomer = {
  JSONData: [
    {
      Name: 'Otto Clay',
      Age: 61,
      Country: 6,
      Address: 'Ap #897-1459 Quam Avenue',
      Married: false,
    },
    {
      Name: 'Connor Johnston',
      Age: 73,
      Country: 7,
      Address: 'Ap #370-4647 Dis Av.',
      Married: false,
    },
    {
      Name: 'Lacey Hess',
      Age: 29,
      Country: 7,
      Address: 'Ap #365-8835 Integer St.',
      Married: false,
    },
    {
      Name: 'Timothy Henson',
      Age: 78,
      Country: 1,
      Address: '911-5143 Luctus Ave',
      Married: false,
    },
    {
      Name: 'Ramona Benton',
      Age: 43,
      Country: 5,
      Address: 'Ap #614-689 Vehicula Street',
      Married: true,
    },
    {
      Name: 'Ezra Tillman',
      Age: 51,
      Country: 1,
      Address: 'P.O. Box 738, 7583 Quisque St.',
      Married: true,
    },
    {
      Name: 'Dante Carter',
      Age: 59,
      Country: 1,
      Address: 'P.O. Box 976, 6316 Lorem, St.',
      Married: false,
    },
    {
      Name: 'Christopher Mcclure',
      Age: 58,
      Country: 1,
      Address: '847-4303 Dictum Av.',
      Married: true,
    },
    {
      Name: 'Ruby Rocha',
      Age: 62,
      Country: 2,
      Address: '5212 Sagittis Ave',
      Married: false,
    },
    {
      Name: 'Imelda Hardin',
      Age: 39,
      Country: 5,
      Address: '719-7009 Auctor Av.',
      Married: false,
    },
    {
      Name: 'Jonah Johns',
      Age: 28,
      Country: 5,
      Address: 'P.O. Box 939, 9310 A Ave',
      Married: false,
    },
    {
      Name: 'Herman Rosa',
      Age: 49,
      Country: 7,
      Address: '718-7162 Molestie Av.',
      Married: true,
    },
    {
      Name: 'Arthur Gay',
      Age: 20,
      Country: 7,
      Address: '5497 Neque Street',
      Married: false,
    },
    {
      Name: 'Xena Wilkerson',
      Age: 63,
      Country: 1,
      Address: 'Ap #303-6974 Proin Street',
      Married: true,
    },
    {
      Name: 'Lilah Atkins',
      Age: 33,
      Country: 5,
      Address: '622-8602 Gravida Ave',
      Married: true,
    },
    {
      Name: 'Malik Shepard',
      Age: 59,
      Country: 1,
      Address: '967-5176 Tincidunt Av.',
      Married: false,
    },
    {
      Name: 'Keely Silva',
      Age: 24,
      Country: 1,
      Address: 'P.O. Box 153, 8995 Praesent Ave',
      Married: false,
    },
    {
      Name: 'Hunter Pate',
      Age: 73,
      Country: 7,
      Address: 'P.O. Box 771, 7599 Ante, Road',
      Married: false,
    },
    {
      Name: 'Mikayla Roach',
      Age: 55,
      Country: 5,
      Address: 'Ap #438-9886 Donec Rd.',
      Married: true,
    },
    {
      Name: 'Upton Joseph',
      Age: 48,
      Country: 4,
      Address: 'Ap #896-7592 Habitant St.',
      Married: true,
    },
    {
      Name: 'Jeanette Pate',
      Age: 59,
      Country: 2,
      Address: 'P.O. Box 177, 7584 Amet, St.',
      Married: false,
    },
    {
      Name: 'Kaden Hernandez',
      Age: 79,
      Country: 3,
      Address: '366 Ut St.',
      Married: true,
    },
    {
      Name: 'Kenyon Stevens',
      Age: 20,
      Country: 3,
      Address: 'P.O. Box 704, 4580 Gravida Rd.',
      Married: false,
    },
    {
      Name: 'Jerome Harper',
      Age: 31,
      Country: 5,
      Address: '2464 Porttitor Road',
      Married: false,
    },
    {
      Name: 'Jelani Patel',
      Age: 36,
      Country: 2,
      Address: 'P.O. Box 541, 5805 Nec Av.',
      Married: true,
    },
    {
      Name: 'Keaton Oconnor',
      Age: 21,
      Country: 1,
      Address: 'Ap #657-1093 Nec, Street',
      Married: false,
    },
    {
      Name: 'Bree Johnston',
      Age: 31,
      Country: 2,
      Address: '372-5942 Vulputate Avenue',
      Married: false,
    },
    {
      Name: 'Maisie Hodges',
      Age: 70,
      Country: 7,
      Address: 'P.O. Box 445, 3880 Odio, Rd.',
      Married: false,
    },
    {
      Name: 'Kuame Calhoun',
      Age: 39,
      Country: 2,
      Address: 'P.O. Box 609, 4105 Rutrum St.',
      Married: true,
    },
    {
      Name: 'Carlos Cameron',
      Age: 38,
      Country: 5,
      Address: 'Ap #215-5386 A, Avenue',
      Married: false,
    },
    {
      Name: 'Fulton Parsons',
      Age: 25,
      Country: 7,
      Address: 'P.O. Box 523, 3705 Sed Rd.',
      Married: false,
    },
    {
      Name: 'Wallace Christian',
      Age: 43,
      Country: 3,
      Address: '416-8816 Mauris Avenue',
      Married: true,
    },
    {
      Name: 'Caryn Maldonado',
      Age: 40,
      Country: 1,
      Address: '108-282 Nonummy Ave',
      Married: false,
    },
    {
      Name: 'Whilemina Frank',
      Age: 20,
      Country: 7,
      Address: 'P.O. Box 681, 3938 Egestas. Av.',
      Married: true,
    },
    {
      Name: 'Emery Moon',
      Age: 41,
      Country: 4,
      Address: 'Ap #717-8556 Non Road',
      Married: true,
    },
    {
      Name: 'Price Watkins',
      Age: 35,
      Country: 4,
      Address: '832-7810 Nunc Rd.',
      Married: false,
    },
    {
      Name: 'Lydia Castillo',
      Age: 59,
      Country: 7,
      Address: '5280 Placerat, Ave',
      Married: true,
    },
    {
      Name: 'Lawrence Conway',
      Age: 53,
      Country: 1,
      Address: 'Ap #452-2808 Imperdiet St.',
      Married: false,
    },
    {
      Name: 'Kalia Nicholson',
      Age: 67,
      Country: 5,
      Address: 'P.O. Box 871, 3023 Tellus Road',
      Married: true,
    },
    {
      Name: 'Brielle Baxter',
      Age: 45,
      Country: 3,
      Address: 'Ap #822-9526 Ut, Road',
      Married: true,
    },
    {
      Name: 'Valentine Brady',
      Age: 72,
      Country: 7,
      Address: '8014 Enim. Road',
      Married: true,
    },
    {
      Name: 'Rebecca Gardner',
      Age: 57,
      Country: 4,
      Address: '8655 Arcu. Road',
      Married: true,
    },
    {
      Name: 'Vladimir Tate',
      Age: 26,
      Country: 1,
      Address: '130-1291 Non, Rd.',
      Married: true,
    },
    {
      Name: 'Vernon Hays',
      Age: 56,
      Country: 4,
      Address: '964-5552 In Rd.',
      Married: true,
    },
    {
      Name: 'Allegra Hull',
      Age: 22,
      Country: 4,
      Address: '245-8891 Donec St.',
      Married: true,
    },
    {
      Name: 'Hu Hendrix',
      Age: 65,
      Country: 7,
      Address: '428-5404 Tempus Ave',
      Married: true,
    },
    {
      Name: 'Kenyon Battle',
      Age: 32,
      Country: 2,
      Address: '921-6804 Lectus St.',
      Married: false,
    },
    {
      Name: 'Gloria Nielsen',
      Age: 24,
      Country: 4,
      Address: 'Ap #275-4345 Lorem, Street',
      Married: true,
    },
    {
      Name: 'Illiana Kidd',
      Age: 59,
      Country: 2,
      Address: '7618 Lacus. Av.',
      Married: false,
    },
    {
      Name: 'Adria Todd',
      Age: 68,
      Country: 6,
      Address: '1889 Tincidunt Road',
      Married: false,
    },
    {
      Name: 'Kirsten Mayo',
      Age: 71,
      Country: 1,
      Address: '100-8640 Orci, Avenue',
      Married: false,
    },
    {
      Name: 'Willa Hobbs',
      Age: 60,
      Country: 6,
      Address: 'P.O. Box 323, 158 Tristique St.',
      Married: false,
    },
    {
      Name: 'Alexis Clements',
      Age: 69,
      Country: 5,
      Address: 'P.O. Box 176, 5107 Proin Rd.',
      Married: false,
    },
    {
      Name: 'Akeem Conrad',
      Age: 60,
      Country: 2,
      Address: '282-495 Sed Ave',
      Married: true,
    },
    {
      Name: 'Montana Silva',
      Age: 79,
      Country: 6,
      Address: 'P.O. Box 120, 9766 Consectetuer St.',
      Married: false,
    },
    {
      Name: 'Kaseem Hensley',
      Age: 77,
      Country: 6,
      Address: 'Ap #510-8903 Mauris. Av.',
      Married: true,
    },
    {
      Name: 'Christopher Morton',
      Age: 35,
      Country: 5,
      Address: 'P.O. Box 234, 3651 Sodales Avenue',
      Married: false,
    },
    {
      Name: 'Wade Fernandez',
      Age: 49,
      Country: 6,
      Address: '740-5059 Dolor. Road',
      Married: true,
    },
    {
      Name: 'Illiana Kirby',
      Age: 31,
      Country: 2,
      Address: '527-3553 Mi Ave',
      Married: false,
    },
    {
      Name: 'Kimberley Hurley',
      Age: 65,
      Country: 5,
      Address: 'P.O. Box 637, 9915 Dictum St.',
      Married: false,
    },
    {
      Name: 'Arthur Olsen',
      Age: 74,
      Country: 5,
      Address: '887-5080 Eget St.',
      Married: false,
    },
    {
      Name: 'Brody Potts',
      Age: 59,
      Country: 2,
      Address: 'Ap #577-7690 Sem Road',
      Married: false,
    },
    {
      Name: 'Dillon Ford',
      Age: 60,
      Country: 1,
      Address: 'Ap #885-9289 A, Av.',
      Married: true,
    },
    {
      Name: 'Hannah Juarez',
      Age: 61,
      Country: 2,
      Address: '4744 Sapien, Rd.',
      Married: true,
    },
    {
      Name: 'Vincent Shaffer',
      Age: 25,
      Country: 2,
      Address: '9203 Nunc St.',
      Married: true,
    },
    {
      Name: 'George Holt',
      Age: 27,
      Country: 6,
      Address: '4162 Cras Rd.',
      Married: false,
    },
    {
      Name: 'Tobias Bartlett',
      Age: 74,
      Country: 4,
      Address: '792-6145 Mauris St.',
      Married: true,
    },
    {
      Name: 'Xavier Hooper',
      Age: 35,
      Country: 1,
      Address: '879-5026 Interdum. Rd.',
      Married: false,
    },
    {
      Name: 'Declan Dorsey',
      Age: 31,
      Country: 2,
      Address: 'Ap #926-4171 Aenean Road',
      Married: true,
    },
    {
      Name: 'Clementine Tran',
      Age: 43,
      Country: 4,
      Address: 'P.O. Box 176, 9865 Eu Rd.',
      Married: true,
    },
    {
      Name: 'Pamela Moody',
      Age: 55,
      Country: 6,
      Address: '622-6233 Luctus Rd.',
      Married: true,
    },
    {
      Name: 'Julie Leon',
      Age: 43,
      Country: 6,
      Address: 'Ap #915-6782 Sem Av.',
      Married: true,
    },
    {
      Name: 'Shana Nolan',
      Age: 79,
      Country: 5,
      Address: 'P.O. Box 603, 899 Eu St.',
      Married: false,
    },
    {
      Name: 'Vaughan Moody',
      Age: 37,
      Country: 5,
      Address: '880 Erat Rd.',
      Married: false,
    },
    {
      Name: 'Randall Reeves',
      Age: 44,
      Country: 3,
      Address: '1819 Non Street',
      Married: false,
    },
    {
      Name: 'Dominic Raymond',
      Age: 68,
      Country: 1,
      Address: 'Ap #689-4874 Nisi Rd.',
      Married: true,
    },
    {
      Name: 'Lev Pugh',
      Age: 69,
      Country: 5,
      Address: 'Ap #433-6844 Auctor Avenue',
      Married: true,
    },
    {
      Name: 'Desiree Hughes',
      Age: 80,
      Country: 4,
      Address: '605-6645 Fermentum Avenue',
      Married: true,
    },
    {
      Name: 'Idona Oneill',
      Age: 23,
      Country: 7,
      Address: '751-8148 Aliquam Avenue',
      Married: true,
    },
    {
      Name: 'Lani Mayo',
      Age: 76,
      Country: 1,
      Address: '635-2704 Tristique St.',
      Married: true,
    },
    {
      Name: 'Cathleen Bonner',
      Age: 40,
      Country: 1,
      Address: '916-2910 Dolor Av.',
      Married: false,
    },
    {
      Name: 'Sydney Murray',
      Age: 44,
      Country: 5,
      Address: '835-2330 Fringilla St.',
      Married: false,
    },
    {
      Name: 'Brenna Rodriguez',
      Age: 77,
      Country: 6,
      Address: '3687 Imperdiet Av.',
      Married: true,
    },
    {
      Name: 'Alfreda Mcdaniel',
      Age: 38,
      Country: 7,
      Address: '745-8221 Aliquet Rd.',
      Married: true,
    },
    {
      Name: 'Zachery Atkins',
      Age: 30,
      Country: 1,
      Address: '549-2208 Auctor. Road',
      Married: true,
    },
    {
      Name: 'Amelia Rich',
      Age: 56,
      Country: 4,
      Address: 'P.O. Box 734, 4717 Nunc Rd.',
      Married: false,
    },
    {
      Name: 'Kiayada Witt',
      Age: 62,
      Country: 3,
      Address: 'Ap #735-3421 Malesuada Avenue',
      Married: false,
    },
    {
      Name: 'Lysandra Pierce',
      Age: 36,
      Country: 1,
      Address: 'Ap #146-2835 Curabitur St.',
      Married: true,
    },
    {
      Name: 'Cara Rios',
      Age: 58,
      Country: 4,
      Address: 'Ap #562-7811 Quam. Ave',
      Married: true,
    },
    {
      Name: 'Austin Andrews',
      Age: 55,
      Country: 7,
      Address: 'P.O. Box 274, 5505 Sociis Rd.',
      Married: false,
    },
    {
      Name: 'Lillian Peterson',
      Age: 39,
      Country: 2,
      Address: '6212 A Avenue',
      Married: false,
    },
    {
      Name: 'Adria Beach',
      Age: 29,
      Country: 2,
      Address: 'P.O. Box 183, 2717 Nunc Avenue',
      Married: true,
    },
    {
      Name: 'Oleg Durham',
      Age: 80,
      Country: 4,
      Address: '931-3208 Nunc Rd.',
      Married: false,
    },
    {
      Name: 'Casey Reese',
      Age: 60,
      Country: 4,
      Address: '383-3675 Ultrices, St.',
      Married: false,
    },
    {
      Name: 'Kane Burnett',
      Age: 80,
      Country: 1,
      Address: '759-8212 Dolor. Ave',
      Married: false,
    },
    {
      Name: 'Stewart Wilson',
      Age: 46,
      Country: 7,
      Address: '718-7845 Sagittis. Av.',
      Married: false,
    },
    {
      Name: 'Charity Holcomb',
      Age: 31,
      Country: 6,
      Address: '641-7892 Enim. Ave',
      Married: false,
    },
    {
      Name: 'Kyra Cummings',
      Age: 43,
      Country: 4,
      Address: 'P.O. Box 702, 6621 Mus. Av.',
      Married: false,
    },
    {
      Name: 'Stuart Wallace',
      Age: 25,
      Country: 7,
      Address: '648-4990 Sed Rd.',
      Married: true,
    },
    {
      Name: 'Carter Clarke',
      Age: 59,
      Country: 6,
      Address: 'Ap #547-2921 A Street',
      Married: false,
    },
  ],

  countryData: [
    { Name: '', Id: 0 },
    { Name: 'United States', Id: 1 },
    { Name: 'Canada', Id: 2 },
    { Name: 'United Kingdom', Id: 3 },
    { Name: 'France', Id: 4 },
    { Name: 'Brazil', Id: 5 },
    { Name: 'China', Id: 6 },
    { Name: 'Russia', Id: 7 },
  ],

  sortBy: {
    Name: 0,
    Age: 0,
    Address: 0,
    Country: 0,
    Married: 0,
    choose: '',
  },

  dataShow: [],
  choosingItem: {},
  bgchoosingItem: '',
  editActive: 0,

  // status checkbox
  indeterminateCheckbox: 1, // 0: indeterminate = false, 1: indeterminate = true, 2: checkbox = true

  // settings pagination
  selectPageSize: [5, 7, 10, 15, 20, 25, 'All'],
  currentPage: 1,
  size: 5,
  totalRecord: 0,
  totalPage: 0,

  // choose html tag generator table
  rootElement: null,

  setRootElementRender(containerId) {
    let containerElement = document.querySelector(containerId);
    this.rootElement = containerElement;
  },

  renderTableLayout() {
    let tableLayout = document.createElement('table');
    let thead = document.createElement('thead');
    let tbody = document.createElement('tbody');

    tableLayout.className = 'table table-responsive-lg table-collapse table-bordered table-hover table-vertical-middle';

    tableLayout.appendChild(thead);
    tableLayout.appendChild(tbody);
    this.rootElement.appendChild(tableLayout);
  },

  renderSearchRow() {
    let thead = this.rootElement.querySelector('thead');
    let searchRow = document.createElement('tr');
    let countryDropdown = this.countryData
      .map((item) => {
        return `<option value=${item.Id}>${item.Name}</option>`;
      })
      .join('');

    let searchHTML = `
        <tr>
          <th><input type="text" class="name-field"></th>
          <th><input type="number" class="age-field"></th>
          <th>
              <select name="country-field" class="country-field"></select>
          </th>
          <th><input type="text" class="address-field"></th>
          <th><input type="checkbox" class="married-field"></th>
          <th>
            <button class="action-btn filter-btn">
              <i class="fas fa-search"></i>
            </button>
            <button class="action-btn clear-filter-btn">
              <i class="fas fa-filter"></i>
            </button>
          </th>
        </tr>`;

    searchRow.className = 'search-row hidden';
    searchRow.innerHTML = searchHTML;

    thead.appendChild(searchRow);
    this.rootElement.querySelector('.search-row .married-field').indeterminate = true;
    this.rootElement.querySelector('.search-row .country-field').innerHTML = countryDropdown;
  },

  renderAddRow() {
    let addRow = document.createElement('tr');
    let countryDropdown = this.countryData
      .map((item) => {
        return `<option value=${item.Id}>${item.Name}</option>`;
      })
      .join('');
    let addHTML = `
        <tr>
          <th><input type="text" class="name-field"></th>
          <th><input type="number" min=1 class="age-field"></th>
          <th>
              <select name="country-field" class="country-field"></select>
          </th>
          <th><input type="text" class="address-field"></th>
          <th><input type="checkbox" class="married-field"></th>
          <th>
            <button class="action-btn confirm-add-btn">
              <i class="fas fa-check"></i>
            </button>
            <button class="action-btn remove-add-btn">
              <i class="fas fa-times"></i>
            </button>
          </th>
        </tr>`;

    addRow.className = 'add-row hidden';
    addRow.innerHTML = addHTML;

    this.rootElement.querySelector('thead').appendChild(addRow);
    this.rootElement.querySelector('.add-row .country-field').innerHTML = countryDropdown;
  },

  renderHeadRow() {
    let thead = this.rootElement.querySelector('thead');
    let headRow = document.createElement('tr');
    let headNames = Object.keys(this.JSONData[0]);
    let headHTML = '';

    headNames.map((headItem) => {
      headHTML += `
          <th class="sort" data-sort=${headItem}>${headItem}
            <button class="sort-icon hidden">
              <i class="fas fa-caret-up"></i>
            </button>
          </th>`;
    });

    headHTML += `
        <th>
          <button class="search-btn action-btn"><i class="fa fa-search"></i></button>
          <button class="add-btn action-btn"><i class="fas fa-plus"></i></button>
        </th>`;

    headRow.innerHTML = headHTML;
    thead.appendChild(headRow);
  },

  renderSelectPageSize() {
    let headActionHTML = `
          <div class="head-action-container">
            <span>Size per page: </span>
            <select name="pagesize" id="pagesize" class="select-page-size">
              ${this.selectPageSize
                .map((option) => {
                  return `<option value=${option}>${option}</option>`;
                })
                .join('')}
            </select>
          </div>
        `;
    this.rootElement.innerHTML = headActionHTML;
  },

  renderPaginationLayout() {
    const paginationContainer = document.createElement('div');
    const pageSelectInfo = document.createElement('p');
    const pages = document.createElement('ul');

    let pagiHtml = `
        <li class="prev-btn hidden">&lt Prev</li>
        <li>
          <ul class="pages-list"></ul>
        </li>
        <li class="next-btn">Next &gt</li>
        <li class="last-btn">Last</li>
      `;

    paginationContainer.className = 'pagination-container';
    pageSelectInfo.className = 'page-info';
    pages.className = 'pagination';

    pages.innerHTML = pagiHtml;
    paginationContainer.appendChild(pages);
    paginationContainer.appendChild(pageSelectInfo);
    this.rootElement.appendChild(paginationContainer);
  },

  renderPaginationNumber() {
    this.totalPage = Math.ceil(this.dataShow.length / this.size);
    let pageArr = this.handlePagination();
    let totalPages = this.rootElement.querySelector('.page-info');
    let pageNumberItems = this.rootElement.querySelector('.pages-list');
    let pagiNumberHTML = '';

    for (let i in pageArr) {
      if (pageArr[i] == this.currentPage) {
        pagiNumberHTML += `<li class='number-page active'>${pageArr[i]}</li>`;
      } else if (pageArr[i] != '...') {
        pagiNumberHTML += `<li class='number-page'>${pageArr[i]}</li>`;
      } else {
        pagiNumberHTML += `<li class='three-dots'>${pageArr[i]}</li>`;
      }
    }

    totalPages.innerHTML = `Page ${this.currentPage} / ${this.totalPage}`;
    pageNumberItems.innerHTML = pagiNumberHTML;
  },

  handlePagination() {
    let currentPage = this.currentPage;
    let lastPage = this.totalPage;
    let delta = 1; // number links two side
    let leftPage = currentPage - delta;
    let rightPage = currentPage + delta + 1;
    let range = [];
    let rangeWithDots = [];
    let itemInRange;

    for (let i = 1; i <= lastPage; i += 1) {
      if (i === 1 || i === lastPage || (i >= leftPage && i <= rightPage)) {
        range.push(i);
      } else if (i < leftPage) {
        i = leftPage - 1;
      } else if (i > rightPage) {
        range.push(lastPage);
        break;
      }
    }

    range.forEach((i) => {
      if (itemInRange) {
        if (i - itemInRange === 2) {
          rangeWithDots.push(itemInRange + 1);
        } else if (i - itemInRange !== 1) {
          rangeWithDots.push('...');
        }
      }
      rangeWithDots.push(i);
      itemInRange = i;
    });

    return rangeWithDots;
  },

  handleUIPageChange() {
    const prevBtn = this.rootElement.querySelector('.pagination .prev-btn');
    const nextBtn = this.rootElement.querySelector('.pagination .next-btn');
    const lastBtn = this.rootElement.querySelector('.pagination .last-btn');

    if (this.currentPage === 1) {
      prevBtn.classList.add('hidden');
    } else {
      prevBtn.classList.remove('hidden');
    }

    if (this.currentPage === this.totalPage) {
      nextBtn.classList.add('hidden');
      lastBtn.classList.add('hidden');
    } else {
      nextBtn.classList.remove('hidden');
      lastBtn.classList.remove('hidden');
    }
  },

  loadPagination() {
    this.renderPaginationNumber();
    this.handleUIPageChange();
  },

  loadData() {
    const start = this.size * (this.currentPage - 1);
    const end = start + this.size < this.dataShow.length ? start + this.size : this.dataShow.length;
    let dataShow = '';
    let pagiContainer = this.rootElement.querySelector('.pagination-container');
    let tbody = this.rootElement.querySelector('tbody');

    if (this.dataShow.length > 0) {
      pagiContainer.style.display = 'flex';

      for (let i = start; i < end; i++) {
        dataShow += `
          <tr class="customer" data-customer="${i}">
              <td>${this.dataShow[i].Name}</td>
              <td class="text-center">${this.dataShow[i].Age}</td>
              <td>
                ${this.countryData[this.dataShow[i].Country].Name}
              </td>
              <td>${this.dataShow[i].Address}</td>
              <td class="text-center">
                  <input type="checkbox" name="married" id="married" ${
                    this.dataShow[i].Married ? 'checked' : ''
                  } disabled/>  
              </td>
              <td class="text-center">
                <button class="action-btn edit-btn"><i class="fas fa-pencil-alt"></i></button>
                <button class="action-btn delete-btn"><i class="fa fa-trash"></i></button>    
              </td>
          </tr>
        `;
      }
    } else {
      dataShow += `<p class="mt-3 text-center text-danger">No results found</p>`;
      pagiContainer.style.display = 'none';
    }

    tbody.innerHTML = dataShow;
  },

  setDataShow(data) {
    this.dataShow = data;
  },

  addEventOnInit() {
    let tbody = this.rootElement.querySelector('tbody');
    let pageSizeSelect = this.rootElement.querySelector('.select-page-size');
    let pageDisplay = this.rootElement.querySelectorAll('.number-page');
    let pageList = this.rootElement.querySelector('.pages-list');
    let btnNext = this.rootElement.querySelector('.next-btn');
    let btnPrevious = this.rootElement.querySelector('.prev-btn');
    let btnLast = this.rootElement.querySelector('.last-btn');
    let btnAdd = this.rootElement.querySelector('.add-btn');
    let confirmAddBtn = this.rootElement.querySelector('.confirm-add-btn');
    let removeAddBtn = this.rootElement.querySelector('.remove-add-btn');
    let searchBtn = this.rootElement.querySelector('.search-btn');
    let filterBtn = this.rootElement.querySelector('.filter-btn');
    let clearFilterBtn = this.rootElement.querySelector('.clear-filter-btn');
    let marriedField = this.rootElement.querySelector('.married-field');

    removeAllActive = () => {
      pageDisplay.forEach((pageItem) => {
        pageItem.classList.remove('active');
      });
    };

    addCurPageActive = () => {
      for (let i in pageDisplay) {
        if (pageDisplay[i].innerText == this.currentPage) {
          pageDisplay[i].className = 'active number-page';
          break;
        }
      }
    };

    resetEditActive = () => {
      this.editActive = 0;
    };

    // onchage page size
    pageSizeSelect.addEventListener('change', (e) => {
      const pageSizeSelect = e.target.value;

      if (pageSizeSelect === 'All') {
        this.size = this.dataShow.length;
        this.loadPagination();
        this.loadData();
      } else {
        this.size = parseInt(pageSizeSelect);
        this.currentPage = 1;
        this.loadPagination();
        this.loadData();
      }

      resetEditActive();
    });

    // show/hide toggle add new records
    btnAdd.addEventListener('click', (e) => {
      let addRow = this.rootElement.querySelector('.add-row');
      let addIcon = e.target;
      let searchBtn = this.rootElement.querySelector('.search-btn');

      addRow.classList.toggle('hidden');
      searchBtn.classList.toggle('hidden');

      if (addIcon.className.includes('fa-plus')) {
        addIcon.classList.add('fa-times');
        addIcon.classList.remove('fa-plus');
      } else {
        addIcon.classList.remove('fa-times');
        addIcon.classList.add('fa-plus');
      }
      resetEditActive();
    });

    // add new customer
    confirmAddBtn.addEventListener('click', () => {
      const addElement = this.rootElement.querySelector('.add-row');
      this.handleAddCustomer(addElement);
    });

    // clear input add customer
    removeAddBtn.addEventListener('click', () => {
      const addElement = this.rootElement.querySelector('.add-row');
      this.clearAddCustomer(addElement);
    });

    // click random page
    pageList.addEventListener('click', (e) => {
      if (!e.target.innerText.includes('...') && e.target.innerText != this.currentPage) {
        removeAllActive();
        resetEditActive();

        this.currentPage = parseInt(e.target.innerText);
        e.target.className = 'active number-page';

        this.loadPagination();
        this.loadData();
      }
    });

    // click next page
    btnNext.addEventListener('click', () => {
      if (this.currentPage < this.totalPage) {
        this.currentPage += 1;
      }
      resetEditActive();
      removeAllActive();
      addCurPageActive();
      this.loadPagination();
      this.loadData();
    });

    // click prev page
    btnPrevious.addEventListener('click', () => {
      if (this.currentPage > 1) {
        this.currentPage -= 1;
      }
      resetEditActive();
      removeAllActive();
      addCurPageActive();
      this.loadPagination();
      this.loadData();
    });

    // click last page
    btnLast.addEventListener('click', () => {
      this.currentPage = this.totalPage;
      resetEditActive();
      removeAllActive();
      pageDisplay[pageDisplay.length - 1].className = 'active number-page';
      this.loadPagination();
      this.loadData();
    });

    // delete customer
    tbody.addEventListener('click', (e) => {
      if (e.target.closest('.delete-btn')) {
        let customerPosition = e.target.closest('.customer').dataset.customer;

        this.deleteCustomer(customerPosition, this.currentPage);
      }
    });

    // show/hide toggle filter
    searchBtn.addEventListener('click', (e) => {
      let addBtn = this.rootElement.querySelector('.add-btn');
      let searchRow = this.rootElement.querySelector('.search-row');
      let searchIcon = e.target;

      searchRow.classList.toggle('hidden');
      addBtn.classList.toggle('hidden');

      if (searchIcon.className.includes('fa-search')) {
        searchIcon.classList.add('fa-times');
        searchIcon.classList.remove('fa-search');
      } else {
        searchIcon.classList.remove('fa-times');
        searchIcon.classList.add('fa-search');
      }
      resetEditActive();
    });

    // filter customer
    filterBtn.addEventListener('click', () => {
      this.filterCustomer();
    });

    // sort by married (change status checkbox)
    marriedField.addEventListener('click', (e) => {
      const checkboxStatus = e.target;

      switch (this.indeterminateCheckbox) {
        case 0: {
          this.indeterminateCheckbox = 1;
          checkboxStatus.indeterminate = true;
          break;
        }
        case 1: {
          this.indeterminateCheckbox = 2;
          checkboxStatus.indeterminate = false;
          checkboxStatus.checked = true;
          break;
        }
        case 2: {
          this.indeterminateCheckbox = 0;
          checkboxStatus.checked = false;
          break;
        }
      }
    });

    // clear filter customer
    clearFilterBtn.addEventListener('click', () => {
      this.handleClearFilter();
    });

    // sort customer
    this.rootElement.querySelector('thead tr').addEventListener('click', (e) => {
      if (e.target.closest('.sort')) {
        const element = e.target;
        const fieldName = e.target.dataset.sort;

        this.handleUISort(element, fieldName);
        this.sortByField(fieldName);
      }
    });

    // edit customer
    tbody.addEventListener('click', (e) => {
      const customerRowHTML = e.target.closest('.customer');
      const isEditBtn = e.target.parentNode.className.includes('edit-btn');
      const isRemoveEditBtn = e.target.parentNode.className.includes('remove-edit-btn');
      const isConfirmEditBtn = e.target.parentNode.className.includes('confirm-edit-btn');

      if (isEditBtn && !this.editActive) {
        this.editActive = 1;
        this.handleUIEdit(customerRowHTML);
      }

      if (isRemoveEditBtn && this.editActive) {
        this.editActive = 0;
        this.handleUIEdit(customerRowHTML, this.bgChoosingItem);
      }

      if (isConfirmEditBtn && this.editActive) {
        this.editActive = 0;
        this.handleEditCustomer(customerRowHTML);
      }
    });
  },

  handleAddCustomer(element) {
    const Name = element.querySelector('.name-field').value.trim();
    const Age = parseInt(element.querySelector('.age-field').value);
    const Address = element.querySelector('.address-field').value.trim();
    const Country = parseInt(element.querySelector('.country-field').value);
    const Married = element.querySelector('.married-field').checked;

    if (Name != '' && Age != '' && Address != '' && Country > 0) {
      const newCustomer = { Name, Age, Country, Address, Married };
      let isDuplicateCustomer = this.JSONData.findIndex((customer) => this.deepEqualObj(customer, newCustomer));

      if (isDuplicateCustomer === -1) {
        this.JSONData.unshift(newCustomer);
        this.loadPagination();
        this.loadData();
        this.clearDataInput();
        this.currentPage = 1;
      }
    }
  },

  handleUIEdit(customerRowHTML, customerEditedHTML = null) {
    this.bgChoosingItem = customerRowHTML.innerHTML;

    if (!customerEditedHTML) {
      const searchIndex = this.dataShow.findIndex(
        (customer) => customer === this.dataShow[customerRowHTML.dataset.customer],
      );
      if (searchIndex != -1) {
        this.choosingItem = this.dataShow[searchIndex];
      }
    }

    if (Object.keys(this.choosingItem).length !== 0) {
      let countryDropdown = this.countryData
        .map((item) => {
          return `<option value=${item.Id} ${item.Id == this.choosingItem.Country ? 'selected' : ''}>${
            item.Name
          }</option>`;
        })
        .join('');

      customerRowHTML.innerHTML =
        customerEditedHTML ||
        ` 
            <tr>
              <td class="text-center">
                <input type="text" class="filter-name" value='${this.choosingItem.Name}' data-customer-value=${
          this.choosingItem.Name
        }>
              </td>
              <td>
                <input type="number" min=0 class="filter-age" value=${this.choosingItem.Age} data-customer-value=${
          this.choosingItem.Age
        }>
              </td>
              <td class="text-center">
              <select class="filter-country">
              ${countryDropdown}
              </select>
              </td>
              <td>
                <input type="text" class="filter-address address-field" value='${this.choosingItem.Address}'>
              </td>
              <td class="text-center">
                <input type="checkbox" class="filter-married" ${this.choosingItem.Married ? 'checked' : ''}>
              </td>
              <td class="text-center">
              <button class="action-btn confirm-edit-btn"><i class="fas fa-check"></i></button>
              <button class="action-btn remove-edit-btn"><i class="fas fa-times"></i></button>
              </td>
            </tr>
          `;
    }
  },

  handleEditCustomer(container) {
    const Name = container.querySelector('.filter-name').value;
    const Age = parseInt(container.querySelector('.filter-age').value);
    const Address = container.querySelector('.filter-address').value;
    const Country = parseInt(container.querySelector('.filter-country').value);
    const Married = container.querySelector('.filter-married').checked;
    const totalCustomer = this.dataShow.length;

    for (let i = 0; i < totalCustomer; i++) {
      if (this.dataShow[i].Name === this.choosingItem.Name) {
        this.dataShow[i] = {
          Name,
          Age,
          Address,
          Country,
          Married,
        };
        break;
      }
    }

    let html = `  
      <tr class="customer">
          <td class="name">${Name}</td>
          <td class="text-center">${Age}</td>
          <td>
            ${this.countryData[Country].Name}
          </td>
          <td>${Address}</td>
          <td class="text-center">
              <input type="checkbox" name="married" ${Married ? 'checked' : ''} disabled/>
          </td>
          <td class="text-center">
          <button class="action-btn edit-btn"><i class="fas fa-pencil-alt"></i></button>
          <button class="action-btn delete-btn"><i class="fa fa-trash"></i></button>
          </td>
      </tr>
      `;

    this.handleUIEdit(container, html);
  },

  handleUISort(element, fieldName) {
    this.sortBy.choose = fieldName;
    this.sortBy[fieldName] = this.sortBy[fieldName] ? 0 : 1; // check sort asc / desc

    // hide all icon sorting in thead
    for (let key in this.JSONData[0]) {
      if (key !== this.sortBy.choose) {
        this.rootElement.querySelector(`th[data-sort=${key}]`).childNodes[1].classList.add('hidden');
      }
    }

    // toggle sort icon
    element.querySelector('.sort-icon').classList.remove('hidden');
    if (this.sortBy[fieldName] === 0) {
      element.querySelector('.sort-icon i').classList.add('fa-caret-up');
      element.querySelector('.sort-icon i').classList.remove('fa-caret-down');
    } else {
      element.querySelector('.sort-icon i').classList.remove('fa-caret-up');
      element.querySelector('.sort-icon i').classList.add('fa-caret-down');
    }
  },

  sortAscending(fieldName) {
    return (a, b) => (a[fieldName] > b[fieldName] ? 1 : -1);
  },
  sortDescending(fieldName) {
    return (b, a) => (a[fieldName] > b[fieldName] ? 1 : -1);
  },

  sortByField(fieldName) {
    if (this.sortBy[fieldName] === 0) {
      this.dataShow = [...this.dataShow].sort(this.sortAscending(fieldName));
      this.currentPage = 1;
      this.loadPagination();
      this.loadData();
    }

    if (this.sortBy[fieldName] === 1) {
      this.dataShow = [...this.dataShow].sort(this.sortDescending(fieldName));
      this.currentPage = 1;
      this.loadPagination();
      this.loadData();
    }
  },

  clearDataInput() {
    this.rootElement.querySelector('.name-field').value = '';
    this.rootElement.querySelector('.age-field').value = '';
    this.rootElement.querySelector('.country-field').value = 0;
    this.rootElement.querySelector('.address-field').value = '';
    this.rootElement.querySelector('.married-field').checked = false;
  },

  filterCustomer() {
    const fieldName = this.rootElement.querySelector('.name-field').value.trim();
    const fieldAge = this.rootElement.querySelector('.age-field').value;
    const fieldCountry = this.rootElement.querySelector('.country-field').value;
    const fieldAddress = this.rootElement.querySelector('.address-field').value.trim();
    const fieldMarried = this.indeterminateCheckbox;

    this.setDataShow(this.JSONData); // reset filter

    // filter query
    if (fieldName != '') {
      this.dataShow = this.dataShow.filter((item) => item.Name.toLowerCase().includes(fieldName.toLowerCase()));
    }

    if (fieldAge > 0) {
      this.dataShow = this.dataShow.filter((item) => item.Age == fieldAge);
    }

    if (fieldCountry > 0) {
      this.dataShow = this.dataShow.filter((item) => item.Country == fieldCountry);
    }

    if (fieldAddress != '') {
      this.dataShow = this.dataShow.filter((item) => item.Address.toLowerCase().includes(fieldAddress.toLowerCase()));
    }

    if (fieldMarried != 1) {
      this.dataShow = this.dataShow.filter((item) => item.Married == (this.indeterminateCheckbox === 0 ? false : true));
    }

    this.currentPage = 1;
    this.loadPagination();
    this.loadData();
  },

  handleClearFilter() {
    this.clearDataInput();
    this.setDataShow(this.JSONData);
    this.currentPage = 1;
    this.loadPagination();
    this.loadData();
  },

  deepEqualObj(objFirst, objSecond) {
    const objKeys = Object.keys;
    const typeOfX = typeof objFirst;
    const typeOfY = typeof objSecond;

    return objFirst && objSecond && typeOfX === 'object' && typeOfX === typeOfY
      ? objKeys(objFirst).length === objKeys(objSecond).length &&
          objKeys(objFirst).every((key) => this.deepEqualObj(objFirst[key], objSecond[key]))
      : objFirst === objSecond;
  },

  deleteCustomer(customerPosition, currentPage) {
    if (confirm('Are you sure delete this customer ?') === true) {
      const amountRowRemaining = this.rootElement.querySelectorAll('tbody tr').length;

      this.JSONData.splice(
        this.JSONData.findIndex((customer) => customer === this.dataShow[customerPosition]),
        1,
      );
      this.setDataShow(this.JSONData);

      // if current page remaining 1 row -> delete row => redirect prev page
      if (amountRowRemaining === 1 && currentPage > 1) {
        this.currentPage = currentPage - 1;
      }

      // while user is editing 1 row, user delete another row, reset active edit status
      this.editActive = 0;

      this.loadPagination();
      this.loadData();
    }
  },

  render() {
    this.renderSelectPageSize();
    this.renderTableLayout();
    this.renderHeadRow();
    this.renderSearchRow();
    this.renderAddRow();
    this.renderPaginationLayout();
    this.renderPaginationNumber();
  },

  init(rootElement) {
    this.setDataShow(this.JSONData);
    this.setRootElementRender(rootElement);
    this.render();
    this.loadData();
    this.addEventOnInit();
  },
};

function init() {
  tableCustomer.init('#root');
}

init();
